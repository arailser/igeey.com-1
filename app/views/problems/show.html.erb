<% @title = "问题：#{@problem.title}"%>

<div class="story_box" >
  <div style="float:right"><%= care_about(@problem)%></div>
  <h2>No.<%= @problem.id %> <%= @problem.title %></h2>
  <span><br/></span>
  <pre><%= @problem.intro %></pre>
</div>

<div style="float:right;margin-bottom:20px;">
  <%= render :partial => '/public/share'%>
</div>

<div class="box" style="line-height:1.3;margin: 0 0 20px; background: #fff1ec; padding: 10px 10px 5px;">
  有什么可以和大家分享的？
  <div style="text-align:center;">
    <%= form_tag new_problem_post_path(@problem),:style => 'font-size:16px;padding:10px;text-align:center',:method => :get do%>
      网址：<%= text_field_tag 'url', '',:placeholder => '如：http://www.example.com',:style => 'font-size:15px;width:380px;padding:5px'%>
      <%= submit_tag '添加',:style=>'font-size:14px;line-height:20px'%>
    <% end %>
  </div>
</div>

<div id="posts" class="box">
  <%= image_tag('/images/icon/loading.gif',:style=>"margin-top:10px;")%>
</div>

<% content_for :sidebar do %>
  
  <div style="background:url('/images/counter.png');height:92px;width:238px;margin:10px 5px 25px">
    <div class="problem_counter">
      <span class="number"><%= @problem.follows_count %></span>
    </div>
    <div class="problem_counter">
      <span class="number" ><%= @problem.kases_count %></span>
    </div>
    <div class="problem_counter">
      <span class="number"><%= @problem.solutions_count %></span>
    </div>
  </div>

  <% unless @following_users.empty? %>
    <div class="box">
      <h5><%= image_tag '/images/icon/eye.png',:class => 'icon'%> 关心这个问题的同学：</h5>
      <% @following_users.each do |user|%>
        <%= link_to (image_tag user.avatar.url,:class => "small_avatar",:alt => user.login),user_path(user),:title => user.login %>
      <% end %>
    </div>
  <% end %>

  <div class="sidebar_panel">
    <h5> 本期关注的公共问题：</h5>
    <% @current_problems.each do |problem|%>
      <p style="border-bottom:1px solid #eee"><%= "No.#{problem.id}"%> <%= link_to_unless_current problem.title, problem%></p>
    <% end %>
    <h5 style="color:#aaa;margin-top:16px"> 上期关注：</h5>
    <% @prev_problems.each do |problem|%>
      <p style="border-bottom:1px solid #eee;"><span><%= "No.#{problem.id}"%> <%= link_to_unless_current problem.title, problem%></span></p>
    <% end %>
    <p><%= image_tag '/images/icon/problem.png',:class => 'icon'%> <%= link_to '添加新问题(不用注册)',new_problem_path %></p>
    <p><%= image_tag '/images/icon/article.gif',:class => 'icon'%> <%= link_to '回到博客',blogs_path %></p>
  </div>

  <div class="box">
   <%= form_for @feedback do |form| %>
    <div style="background:#ffffcc;padding:10px;border:1px dashed #eebb55;margin:5px">
      <%= image_tag '/images/icon/checkbox.png',:class => 'icon'%>
      <span>小调查：告诉我们你还想在这个页面看到什么? (不注册也可以填写)</span>
      <p><%= form.text_field :text, :style => "width:200px;",:placeholder => "写什么都可以"%></p>
      <%= form.submit '发出去!'%>
    </div>
  <% end %>
  </div>

<% end %>

<% content_for :extension do %>
  <script type="text/javascript" charset="utf-8">  
    window.ajax_posts = function(name){
      $.get("<%= problem_posts_path(@problem)%>", {tag_name:name}, function(data) {
        $('#posts').html(data);
      });
    };
    
    $('.post_tag').live('click', function(e){
      $('#posts').html('<%= image_tag("/images/icon/loading.gif",:style=>"margin-top:10px;")%>');
      tag_name = $(this).html();
      window.ajax_posts(tag_name);
    });
    
    $(document).ready(function(){
      window.ajax_posts();
    });
  </script>
<% end %>

